# 要件定義書

## はじめに

交通費申請の代行エージェントシステムは、企業の従業員が出張や業務移動の交通費を申請する際のプロセスを自動化するシステムです。Amazon Bedrockを活用した対話型インターフェースを通じて、ユーザーから移動情報を収集し、経路間の交通費を自動計算し、申請書を作成してローカルに保存します。これにより、手動での申請書作成の手間を省き、入力ミスや計算ミスを削減し、差し戻しによる修正作業を大幅に削減します。

## 用語集

- **System**: 交通費申請の代行エージェントシステム全体
- **User**: システムを使用する企業の従業員
- **Agent**: AWS Strandsで構築されたAIエージェント
- **Travel_Route**: 出発地から目的地までの移動経路
- **Expense_Report**: 交通費申請書
- **Bedrock**: Amazon Bedrockサービス
- **Conversation_Session**: ユーザーとエージェント間の対話セッション
- **Route_Data**: 経路情報（出発地、目的地、日付、交通手段など）
- **Calculation_Result**: 交通費の計算結果
- **Fare_Data**: ローカルのdataフォルダに保存された運賃データ
- **Train_Route_Table**: 東京都内の代表的な電車経路と運賃のテーブル
- **Fixed_Fare**: バス、タクシー、飛行機の一定金額の運賃

## 要件

### 要件1: 自然言語による対話

**ユーザーストーリー:** ユーザーとして、複雑なフォームを使わずに自然な会話で移動情報を提供できるようにしたい。

#### 受入基準

1. ユーザーがシステムを起動した場合、システムはユーザーとの対話セッションを開始する
2. ユーザーが自然言語で移動情報を提供した場合、エージェントは入力から関連する経路データを抽出する
3. 抽出された情報が不完全である場合、エージェントは不足している詳細を収集するためのフォローアップ質問をする
4. ユーザーが曖昧な情報を提供した場合、エージェントは処理を進める前に明確化を要求する
5. 対話セッションがアクティブである間、システムは複数のやり取りにわたってコンテキストを維持する

### 要件2: 交通費の自動計算

**ユーザーストーリー:** ユーザーとして、各経路の交通費をシステムに自動計算してもらい、正確な申請金額を知りたい。

#### 受入基準

1. 経路データが収集された場合、システムはローカルのdataフォルダ内の運賃データを参照してその経路の交通費を計算する
2. システムは入力された一区間ごとに交通費を計算してユーザーに確認を求める
3. 一区間の確認が完了した場合、システムは次に申請する区間がないか確認する
4. 追加の区間がある場合、システムは追加区間についても交通費の計算とユーザーへの確認を行う
5. 電車の費用を計算する場合、システムはdataフォルダ内の東京都内の代表的な経路の運賃テーブルを参照する
6. バス、タクシー、または飛行機の費用を計算する場合、システムはdataフォルダ内の一定金額の運賃データを使用する
7. 経路が複数の交通手段を含む場合、システムは各交通手段の費用を合算して合計費用を計算する
8. システムは電車、バス、タクシー、飛行機を含む交通手段をサポートする

### 要件3: 計算結果の確認と修正

**ユーザーストーリー:** ユーザーとして、確定前にすべての計算された経路と費用を確認し、情報の正確性を検証したい。

#### 受入基準

1. すべての区間の入力と確認が完了した場合、システムは最終確認を行う
2. 最終確認時に、システムはすべての経路とその費用の要約を表示する
3. 要約を表示する場合、システムは出発地、目的地、日付、交通手段、費用を含む経路の詳細を表示する
4. ユーザーが要約を確認する場合、システムはユーザーが確認または修正を要求できるようにする
5. ユーザーが修正を要求した場合、システムは特定の経路情報の編集を許可する
6. 修正が行われた場合、システムは影響を受ける費用を即座に再計算する

### 要件4: 申請書の生成

**ユーザーストーリー:** ユーザーとして、承認のために提出できる申請書ドキュメントをシステムに生成してもらいたい。

#### 受入基準

1. 最終確認が完了した場合、システムは申請書の形式（PDFまたはJSON）をユーザーに質問する
2. ユーザーが形式を選択した場合、システムは選択された形式で交通費申請書ドキュメントを生成する
3. 申請書を生成する場合、システムはすべての経路の詳細と計算された費用を区間ごとに一覧形式で表示する
4. 申請書を生成する場合、システムは会社の基準に従ってドキュメントをフォーマットする
5. システムは申請書に合計経費金額を計算して表示する

### 要件5: ローカル保存

**ユーザーストーリー:** ユーザーとして、後で提出するためにアクセスできるように、申請書をローカルに保存してもらいたい。

#### 受入基準

1. 申請書が生成された場合、システムはそれをローカルのOutputフォルダに保存する
2. 申請書を保存する場合、システムは日付とユーザー識別子を含む明確な命名規則を使用する
3. 同じ名前のファイルが存在する場合、システムは競合を適切に処理する
4. ファイルが保存された場合、システムは保存場所をユーザーに確認する
5. ユーザーがPDF形式を選択した場合、システムは人間が読みやすいフォーマットでPDFファイルを作成する
6. ユーザーがJSON形式を選択した場合、システムは構造化されたデータとしてJSONファイルを保存する

### 要件6: エラーハンドリング

**ユーザーストーリー:** ユーザーとして、問題が発生した場合でも申請書を完成できるように、システムにエラーを適切に処理してもらいたい。

#### 受入基準

1. Bedrockサービスが利用できない場合、システムはユーザーに通知してガイダンスを提供する
2. 経路の計算が失敗した場合、システムはユーザーに通知して再試行または手動入力を許可する
3. ファイル保存が失敗した場合、システムはユーザーに通知して代替保存場所を提案する
4. エラーが発生した場合、システムは対話状態を保持してユーザーが続行できるようにする
5. システムはトラブルシューティングのためにエラーをログに記録する

### 要件7: 入力データの検証

**ユーザーストーリー:** ユーザーとして、提出エラーを避けるために、入力データを検証してもらいたい。

#### 受入基準

1. ユーザーが日付を提供した場合、システムはそれが有効な形式と妥当な範囲にあることを検証する
2. ユーザーが場所情報を提供した場合、システムは場所が認識可能であることを検証する
3. ユーザーが手動で費用情報を提供した場合、システムは金額が正の数であることを検証する
4. 無効なデータが検出された場合、システムはユーザーに通知して修正を要求する
5. システムは無効または不完全なデータを含む交通費申請書の生成を防止する

### 要件8: 技術要件

**ユーザーストーリー:** 開発者として、システムの保守性と拡張性を確保するために、エージェントのオーケストレーションにAWS Strandsを使用したい。

#### 受入基準

1. システムはエージェント実装にAWS Strandsフレームワークを使用する
2. システムは自然言語処理機能にAmazon Bedrockを使用する
3. システムはAWS CLIの認証情報を使用してAWSサービスで認証する
4. システムはstructure.mdで定義されたプロジェクト構造に従う
5. システムはStrandsパターンを使用して適切なエラーハンドリングと状態管理を実装する

### 要件9: 運賃データの管理

**ユーザーストーリー:** 開発者として、運賃データをローカルで管理し、システムが参照できるようにしたい。

#### 受入基準

1. システムはdataフォルダ内に運賃データファイルを保存する
2. システムは東京都内の代表的な電車経路の運賃データを含むファイルを読み込む
3. システムはバス、タクシー、飛行機の一定金額の運賃データを含むファイルを読み込む
4. 運賃データファイルが見つからない場合、システムはエラーを通知してシステムを適切に終了する
5. システムは運賃データを構造化された形式（JSON、CSV等）で保存する
